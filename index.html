<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leo Flora Catalog - 线上展厅</title>
    <script src="//cdn.jsdelivr.net/npm/leancloud-storage@4.15.0/dist/av-min.js"></script>
    <style>
        :root { --primary-color: #1a1a1a; --accent-color: #d4af37; --bg-color: #fcfcfc; }
        body { font-family: -apple-system, sans-serif; margin: 0; background: var(--bg-color); padding-bottom: 80px; }
        
        /* 导航栏 */
        header { background: white; padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 1px 0 rgba(0,0,0,0.05); }
        
        /* Logo 区域样式 */
        .brand-container { display: flex; align-items: center; gap: 12px; }
        .logo-img { height: 40px; width: auto; object-fit: contain; border-radius: 4px; }
        .logo-text { font-size: 1.4rem; font-weight: 800; letter-spacing: 1px; text-transform: uppercase; color: var(--primary-color); }
        
        /* 搜索与语言 */
        .controls { display: flex; gap: 15px; align-items: center; }
        .search-input { padding: 8px 20px; border: 1px solid #eee; border-radius: 20px; outline: none; width: 220px; background: #f5f5f5; transition: 0.3s; }
        .search-input:focus { background: white; border-color: var(--accent-color); width: 280px; }
        
        /* 产品网格 */
        .container { max-width: 1400px; margin: 40px auto; padding: 0 20px; }
        .product-grid { display: grid; gap: 30px; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); }
        .product-card { background: white; border-radius: 8px; overflow: hidden; position: relative; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); border: 1px solid #f0f0f0; }
        .product-card:hover { transform: translateY(-8px); box-shadow: 0 15px 40px rgba(0,0,0,0.08); }
        .product-img { width: 100%; aspect-ratio: 1/1; object-fit: cover; cursor: pointer; }
        .product-info { padding: 20px; }
        .sku { font-size: 0.75rem; color: #999; font-weight: 700; font-family: monospace; }
        .title { font-size: 1.05rem; margin: 8px 0; font-weight: 600; color: #333; }
        
        /* 收藏按钮 */
        .fav-btn { position: absolute; top: 15px; right: 15px; width: 38px; height: 38px; border-radius: 50%; background: rgba(255,255,255,0.9); border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.1); font-size: 18px; transition: 0.3s; z-index: 10; }
        .fav-btn:hover { transform: scale(1.1); background: white; }
        .fav-btn.active { color: #e74c3c; background: white; }

        /* 底部悬浮条 */
        .floating-bar { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--primary-color); color: white; padding: 14px 30px; border-radius: 40px; cursor: pointer; z-index: 200; box-shadow: 0 10px 40px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 12px; transition: 0.3s; }
        .floating-bar:hover { transform: translateX(-50%) translateY(-2px); background: #333; }
        .badge { background: var(--accent-color); color: white; padding: 2px 10px; border-radius: 12px; font-size: 0.85rem; font-weight: bold; }

        /* 弹窗通样式 */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.75); z-index: 300; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
        .modal-content { background: white; width: 90%; max-width: 450px; border-radius: 24px; padding: 35px; position: relative; max-height: 85vh; overflow-y: auto; }
        .close-btn { position: absolute; top: 20px; right: 20px; font-size: 28px; cursor: pointer; color: #ddd; transition: 0.3s; }
        .close-btn:hover { color: #666; }
        
        /* 联系按钮 (Linktree 风格) */
        .contact-link { display: flex; align-items: center; justify-content: center; padding: 15px; border-radius: 14px; text-decoration: none; color: white; font-weight: 600; margin-bottom: 12px; transition: 0.3s; border: none; width: 100%; cursor: pointer; font-size: 15px; }
        .contact-link:hover { opacity: 0.9; transform: scale(1.02); }
        .btn-wechat { background: #07C160; }
        .btn-whatsapp { background: #25D366; }
        .btn-email { background: #333; }
        .btn-ins { background: linear-gradient(45deg, #f09433, #dc2743, #bc1888); }
        
        .export-btn { background: var(--primary-color); color: white; width: 100%; padding: 18px; border: none; border-radius: 14px; font-weight: bold; cursor: pointer; margin-top: 20px; font-size: 16px; }

        @media (max-width: 768px) {
            header { padding: 15px 20px; flex-direction: column; gap: 15px; }
            .search-input { width: 100%; }
            .search-input:focus { width: 100%; }
            .product-grid { grid-template-columns: 1fr 1fr; gap: 12px; }
        }
    </style>
</head>
<body>

    <header>
        <div class="brand-container">
            <img src="https://img.leofaux.com/products/leofauxlogo.png" alt="Leo Flora Logo" class="logo-img">
            <div class="logo-text">Leo Flora</div>
        </div>
        <div class="controls">
            <select id="lang-select" onchange="changeLanguage(this.value)" style="border:none; background:none; cursor:pointer; font-weight: 600;">
                <option value="zh">CN</option>
                <option value="en">EN</option>
                <option value="es">ES</option>
                <option value="ar">AR</option>
            </select>
            <input type="text" id="search-input" class="search-input" placeholder="搜索货号..." oninput="filterProducts()">
        </div>
    </header>

    <div class="container">
        <div id="loading" style="text-align:center; padding:100px; color:#999; font-style: italic;">正在为您布展...</div>
        <div id="product-grid" class="product-grid"></div>
    </div>

    <div class="floating-bar" id="floating-bar" onclick="openFavModal()" style="display:none;">
        <span>我的意向清单</span>
        <span class="badge" id="fav-count">0</span>
    </div>

    <div class="modal-overlay" id="fav-modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeFavModal()">&times;</span>
            <h2 style="text-align:center; margin-bottom:25px; font-size: 20px;">确认您的选品</h2>
            <div id="fav-items-container" style="margin-bottom: 20px;"></div>
            <button class="export-btn" onclick="exportToExcel()">导出选品清单 (Excel)</button>
        </div>
    </div>

    <div class="modal-overlay" id="contact-modal">
        <div class="modal-content" style="text-align:center;">
            <span class="close-btn" onclick="closeContactModal()">&times;</span>
            <div style="font-size: 50px; margin-bottom: 10px;">✨</div>
            <h3 style="margin:0 0 10px 0; font-size: 22px;">清单已生成！</h3>
            <p style="color:#666; font-size:14px; margin-bottom:25px; line-height: 1.5;">请将下载的文件发送给 Leo<br>我们将为您确认库存并提供正式报价</p>
            
            <button class="contact-link btn-wechat" onclick="copyText('Leo92-02')">微信 / WeChat: Leo92-02 (点击复制)</button>
            <a href="https://wa.me/8618657926791" target="_blank" class="contact-link btn-whatsapp">WhatsApp: +86 186 5792 6791</a>
            <a href="mailto:lcf18657926791@gmail.com" class="contact-link btn-email">Email: lcf18657926791@gmail.com</a>
            <a href="https://www.instagram.com/leoflorist" target="_blank" class="contact-link btn-ins">Instagram: @leoflorist</a>
            
            <button onclick="closeContactModal()" style="background:none; border:none; color:#bbb; margin-top:20px; cursor:pointer; font-size: 13px;">以后再说</button>
        </div>
    </div>

    <script>
        // 配置你的 LeanCloud 密钥 (已根据你之前的代码填充)
        const APP_ID = "14iZrTXCibSIZUvrYW1Zx0Nv-MdYXbMMI"; 
        const APP_KEY = "4ClJ1QFB6kPuL8tPCzXe0F1l";
        const SERVER_URL = "https://14izrtxc.api.lncldglobal.com";

        let products = [];
        let favorites = [];
        let currentLang = 'zh';

        function init() {
            AV.init({ appId: APP_ID, appKey: APP_KEY, serverURLs: SERVER_URL });
            loadFavorites();
            fetchData();
        }

        function fetchData() {
            const query = new AV.Query('Product');
            query.limit(1000);
            query.find().then(res => {
                products = res.map(p => ({
                    id: p.id,
                    sku: p.get('sku'),
                    img: p.get('img'),
                    name_zh: p.get('name_zh') || p.get('name'),
                    name_en: p.get('name_en'),
                    name_es: p.get('name_es'),
                    name_ar: p.get('name_ar')
                }));
                document.getElementById('loading').style.display = 'none';
                renderProducts(products);
            }).catch(err => {
                console.error("数据加载失败", err);
                document.getElementById('loading').innerText = "加载失败，请检查网络或配置";
            });
        }

        function renderProducts(list) {
            const grid = document.getElementById('product-grid');
            grid.innerHTML = list.map(p => {
                const isFav = favorites.find(f => f.id === p.id);
                const displayName = p['name_' + currentLang] || p.name_zh || 'Flower Item';
                return `
                <div class="product-card">
                    <img src="${p.img}" class="product-img" loading="lazy" onclick="toggleFav('${p.id}')">
                    <button class="fav-btn ${isFav ? 'active' : ''}" onclick="toggleFav('${p.id}')">
                        ${isFav ? '❤️' : '➕'}
                    </button>
                    <div class="product-info">
                        <div class="sku">${p.sku}</div>
                        <div class="title">${displayName}</div>
                    </div>
                </div>`;
            }).join('');
        }

        function toggleFav(id) {
            const p = products.find(x => x.id === id);
            const index = favorites.findIndex(f => f.id === id);
            if (index === -1) {
                favorites.unshift({ ...p, favTime: Date.now() });
            } else {
                favorites.splice(index, 1);
            }
            saveFavorites();
            renderProducts(products);
            updateBadge();
        }

        function updateBadge() {
            const bar = document.getElementById('floating-bar');
            const countEl = document.getElementById('fav-count');
            countEl.innerText = favorites.length;
            bar.style.display = favorites.length > 0 ? 'flex' : 'none';
        }

        function renderFavList() {
            const container = document.getElementById('fav-items-container');
            container.innerHTML = favorites.map(f => `
                <div style="display:flex; align-items:center; gap:15px; margin-bottom:12px; background:#f9f9f9; padding:10px; border-radius:12px;">
                    <img src="${f.img}" style="width:50px; height:50px; object-fit:cover; border-radius:6px;">
                    <div style="flex:1">
                        <div style="font-size:12px; font-weight:bold;">${f.sku}</div>
                        <div style="font-size:14px; color:#666;">${f.name_zh}</div>
                    </div>
                    <button onclick="toggleFav('${f.id}'); renderFavList();" style="border:none; background:none; color:#ccc; cursor:pointer; font-size:18px;">&times;</button>
                </div>
            `).join('') || '<p style="text-align:center; color:#999; padding:20px;">您的清单还是空的</p>';
        }

        function exportToExcel() {
            if (favorites.length === 0) return;
            
            // 简单的 CSV 导出逻辑
            let csvContent = "\ufeffSKU,Product Name,Image Link\n";
            favorites.forEach(f => {
                csvContent += `${f.sku},${f.name_zh},${f.img}\n`;
            });
            
            const link = document.createElement('a');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            link.href = URL.createObjectURL(blob);
            link.download = `LeoFlora_Wishlist_${new Date().toLocaleDateString()}.csv`;
            link.click();

            // 成功导出后弹出联系卡片
            closeFavModal();
            setTimeout(() => {
                document.getElementById('contact-modal').style.display = 'flex';
            }, 600);
        }

        function saveFavorites() { localStorage.setItem('leo_favs_v2', JSON.stringify(favorites)); }
        function loadFavorites() { 
            const saved = localStorage.getItem('leo_favs_v2');
            if (saved) favorites = JSON.parse(saved);
            updateBadge();
        }
        function openFavModal() { renderFavList(); document.getElementById('fav-modal').style.display = 'flex'; }
        function closeFavModal() { document.getElementById('fav-modal').style.display = 'none'; }
        function closeContactModal() { document.getElementById('contact-modal').style.display = 'none'; }
        function copyText(text) {
            navigator.clipboard.writeText(text).then(() => alert("已复制微信号: " + text));
        }
        function filterProducts() {
            const key = document.getElementById('search-input').value.toLowerCase();
            const filtered = products.filter(p => p.sku.toLowerCase().includes(key) || p.name_zh.toLowerCase().includes(key));
            renderProducts(filtered);
        }
        function changeLanguage(l) { currentLang = l; renderProducts(products); }

        init();
    </script>
</body>
</html>
