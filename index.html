<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leo Flora Catalog</title>
    <script src="//cdn.jsdelivr.net/npm/leancloud-storage@4.15.0/dist/av-min.js"></script>
    <style>
        :root { --primary-color: #2c3e50; --accent-color: #e74c3c; --bg-color: #f8f9fa; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 0; padding: 0; background-color: var(--bg-color); color: #333; padding-bottom: 100px; }
        header { background: white; padding: 15px 30px; box-shadow: 0 2px 15px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center; }
        h1 { margin: 0; font-size: 1.2rem; color: var(--primary-color); display: flex; align-items: center; gap: 10px; }
        .logo-icon { font-size: 1.5rem; }
        .container { max-width: 1200px; margin: 20px auto; padding: 0 20px; }
        .product-grid { display: grid; gap: 20px; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); }
        .product-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); position: relative; display: flex; flex-direction: column; transition: transform 0.2s; }
        .product-card:hover { transform: translateY(-5px); }
        
        /* ğŸ‘‡ ä¿®æ”¹ç‚¹ï¼šç»™å›¾ç‰‡åŠ äº†æ‰‹å‹é¼ æ ‡ï¼Œæç¤ºå¯ç‚¹å‡» */
        .product-img { width: 100%; height: 240px; object-fit: cover; background: #eee; cursor: zoom-in; }
        
        .product-info { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; }
        .product-sku { font-size: 0.75rem; color: #888; margin-bottom: 6px; background: #f0f2f5; display: inline-block; padding: 3px 8px; border-radius: 4px; width: fit-content; }
        .product-title { font-size: 1.1rem; font-weight: bold; margin: 0 0 8px 0; }
        .product-desc { font-size: 0.85rem; color: #666; margin: 0; }
        .fav-btn { position: absolute; top: 10px; right: 10px; width: 40px; height: 40px; border-radius: 50%; background: rgba(255,255,255,0.9); display: flex; align-items: center; justify-content: center; cursor: pointer; border: 1px solid rgba(0,0,0,0.1); font-size: 20px; color: #ccc; transition: all 0.2s; }
        .fav-btn.active { background: white; color: var(--accent-color); transform: scale(1.1); }
        .floating-bar { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--primary-color); color: white; padding: 12px 25px; border-radius: 50px; box-shadow: 0 8px 30px rgba(0,0,0,0.3); cursor: pointer; display: flex; align-items: center; gap: 10px; z-index: 200; font-weight: 500; }
        .count-badge { background: var(--accent-color); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; font-weight: bold; }
        
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 300; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
        .modal-content { background: white; width: 90%; max-width: 500px; border-radius: 16px; padding: 30px; box-sizing: border-box; position: relative; }
        
        /* ğŸ‘‡ æ–°å¢ï¼šå¤§å›¾æŸ¥çœ‹å™¨çš„æ ·å¼ */
        #img-viewer { z-index: 999; background: rgba(0,0,0,0.9); cursor: zoom-out; }
        #big-img { max-width: 95%; max-height: 95vh; object-fit: contain; border-radius: 4px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }

        .login-input { width: 100%; padding: 14px; margin: 8px 0 20px 0; border: 2px solid #eee; border-radius: 8px; box-sizing: border-box; }
        .login-btn, .export-btn { background: var(--primary-color); color: white; width: 100%; padding: 14px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; }
        .export-btn { background: #27ae60; margin-top: 20px; }
        .list-item { padding: 15px 0; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 15px; }
        .list-thumb { width: 60px; height: 60px; object-fit: cover; border-radius: 6px; }
        .list-details { flex-grow: 1; }
        .close-btn { position: absolute; top: 15px; right: 20px; font-size: 28px; cursor: pointer; color: #bbb; }
        .loading { text-align: center; padding: 50px; color: #999; }
        
        @media (max-width: 768px) {
            .product-grid { grid-template-columns: 1fr; gap: 15px; }
            .product-card { flex-direction: row; align-items: stretch; height: auto; }
            .product-img { width: 120px; height: auto; min-height: 120px; }
            .fav-btn { top: 50%; right: 15px; transform: translateY(-50%); background: #f8f9fa; border: 1px solid #eee; }
        }
    </style>
</head>
<body>

    <header>
        <h1><span class="logo-icon">ğŸŒ¿</span> Leo Flora</h1>
        <div style="display:flex; align-items:center;">
            <span id="header-user-name" style="font-size:0.9rem;color:#666;margin-right:15px;"></span>
            <div style="font-size:12px;color:#999;cursor:pointer;border:1px solid #eee;padding:4px 8px;border-radius:4px;" onclick="showLoginModal()">ä¿®æ”¹</div>
        </div>
    </header>

    <div class="container">
        <div id="loading-tip" class="loading">æ­£åœ¨è¿æ¥ LeanCloud æ•°æ®...</div>
        <div id="product-grid" class="product-grid"></div>
    </div>

    <div class="floating-bar" onclick="openFavModal()">
        <span>æŸ¥çœ‹æˆ‘çš„æ„å‘æ¸…å•</span>
        <span class="count-badge" id="fav-count">0</span>
    </div>

    <div class="modal-overlay" id="img-viewer" onclick="closeBigImg()">
        <img id="big-img" src="" alt="å¤§å›¾">
    </div>

    <div class="modal-overlay" id="login-modal" style="display:flex;">
        <div class="modal-content" style="text-align:center;">
            <h2 style="margin-top:0;">æ¬¢è¿å…‰ä¸´ Leo Flora</h2>
            <p style="color:#666; font-size:14px; margin-bottom:25px;">è¯·å¡«å†™è”ç³»ä¿¡æ¯å¼€å§‹é€‰å“</p>
            <input type="text" id="input-name" class="login-input" placeholder="æ‚¨çš„ç§°å‘¼ / å…¬å¸å">
            <input type="text" id="input-contact" class="login-input" placeholder="è”ç³»æ–¹å¼ (å¾®ä¿¡/é‚®ç®±)">
            <button class="login-btn" onclick="saveUserInfo()">å¼€å§‹é€‰å“</button>
        </div>
    </div>

    <div class="modal-overlay" id="fav-modal">
        <div class="modal-content" style="max-height:85vh; display:flex; flex-direction:column;">
            <span class="close-btn" onclick="closeFavModal()">&times;</span>
            <h2 style="margin-top:0;">ğŸ“‹ æ„å‘æ¸…å•ç¡®è®¤</h2>
            <div id="fav-items-container" style="flex-grow:1; overflow-y:auto;"></div>
            <button class="export-btn" onclick="exportToExcel()">ğŸ“¥ å¯¼å‡º Excel æ¸…å•</button>
        </div>
    </div>

    <script>
        // ==========================================
        // ğŸ‘‡ğŸ‘‡ğŸ‘‡ è¯·å†æ¬¡å¡«å…¥ LeanCloud å¯†é’¥ (å› ä¸ºæ˜¯æ–°æ–‡ä»¶) ğŸ‘‡ğŸ‘‡ğŸ‘‡
        const APP_ID = "14iZrTXCibSIZUvrYW1Zx0Nv-MdYXbMMI"; 
        const APP_KEY = "4ClJ1QFB6kPuL8tPCzXe0F1l";
        const SERVER_URL = "https://14izrtxc.api.lncldglobal.com"; 
        // ==========================================

        let products = [];
        let favorites = [];
        let userInfo = { name: "", contact: "" };

        function init() {
            if (APP_ID.includes("è¯·åœ¨è¿™é‡Œ")) {
                document.getElementById('loading-tip').innerText = "âš ï¸ è¯·å…ˆåœ¨ GitHub ä»£ç ä¸­å¡«å…¥æ‚¨çš„ App ID å’Œ Key";
                return;
            }
            AV.init({ appId: APP_ID, appKey: APP_KEY, serverURLs: SERVER_URL });

            try {
                const savedFavs = localStorage.getItem('leo_favs_lc');
                if (savedFavs) favorites = JSON.parse(savedFavs);
                const savedUser = localStorage.getItem('leo_user_lc');
                if (savedUser) userInfo = JSON.parse(savedUser);
            } catch (e) {}
            checkLogin();
            updateBadge();

            const query = new AV.Query('Product');
            query.limit(1000); 
            query.find().then((results) => {
                products = results.map(item => {
                    return {
                        id: item.id,
                        sku: item.get('sku') || "",
                        name: item.get('name') || "",
                        desc: item.get('desc') || "",
                        img: item.get('img') || ""
                    };
                });
                document.getElementById('loading-tip').style.display = 'none';
                renderProducts();
            }, (error) => {
                document.getElementById('loading-tip').innerText = "æ•°æ®åŠ è½½å¤±è´¥: " + error.message;
            });
        }

        function renderProducts() {
            const container = document.getElementById('product-grid');
            container.innerHTML = products.map(p => {
                const isFav = favorites.find(f => f.id === p.id);
                // ğŸ‘‡ ä¿®æ”¹ç‚¹ï¼šç‚¹å‡»å›¾ç‰‡è§¦å‘ showBigImg å‡½æ•°
                return `
                <div class="product-card">
                    <img src="${p.img}" class="product-img" loading="lazy" onclick="showBigImg('${p.img}')" title="ç‚¹å‡»æŸ¥çœ‹å¤§å›¾">
                    <button class="fav-btn ${isFav ? 'active' : ''}" onclick="toggleFav('${p.id}')">
                        ${isFav ? 'â¤ï¸' : 'â•'}
                    </button>
                    <div class="product-info">
                        <span class="product-sku">NO. ${p.sku}</span>
                        <div class="product-title">${p.name}</div>
                        <div class="product-desc">${p.desc}</div>
                    </div>
                </div>`;
            }).join('');
        }

        // ğŸ‘‡ æ–°å¢ï¼šæ˜¾ç¤ºå¤§å›¾é€»è¾‘
        function showBigImg(url) {
            document.getElementById('big-img').src = url;
            document.getElementById('img-viewer').style.display = 'flex';
        }
        // ğŸ‘‡ æ–°å¢ï¼šå…³é—­å¤§å›¾é€»è¾‘ (ä¸ä¼šåˆ·æ–°é¡µé¢ï¼Œæ‰€ä»¥ä¸å½±å“æ»šåŠ¨ä½ç½®)
        function closeBigImg() {
            document.getElementById('img-viewer').style.display = 'none';
        }

        function toggleFav(id) {
            const product = products.find(p => p.id === id);
            const index = favorites.findIndex(f => f.id === id);
            if (index === -1) { favorites.push({ ...product, time: Date.now() }); } 
            else { favorites.splice(index, 1); }
            try { localStorage.setItem('leo_favs_lc', JSON.stringify(favorites)); } catch (e) {}
            renderProducts();
            updateBadge();
            if(document.getElementById('fav-modal').style.display === 'flex') renderFavList();
        }

        function updateBadge() { document.getElementById('fav-count').innerText = favorites.length; }
        function checkLogin() {
            if (userInfo.name) {
                document.getElementById('login-modal').style.display = 'none';
                document.getElementById('header-user-name').innerText = `Hi, ${userInfo.name}`;
            } else { document.getElementById('login-modal').style.display = 'flex'; }
        }
        function showLoginModal() { document.getElementById('login-modal').style.display = 'flex'; }
        function saveUserInfo() {
            userInfo.name = document.getElementById('input-name').value.trim();
            userInfo.contact = document.getElementById('input-contact').value.trim();
            if(!userInfo.name) return alert("è¯·å¡«å†™ä¿¡æ¯");
            try { localStorage.setItem('leo_user_lc', JSON.stringify(userInfo)); } catch(e) {}
            checkLogin();
        }
        function openFavModal() { renderFavList(); document.getElementById('fav-modal').style.display = 'flex'; }
        function closeFavModal() { document.getElementById('fav-modal').style.display = 'none'; }
        function renderFavList() {
            const container = document.getElementById('fav-items-container');
            if (favorites.length === 0) { container.innerHTML = '<div style="text-align:center;color:#ccc;margin-top:50px;">æ¸…å•ä¸ºç©º</div>'; return; }
            favorites.sort((a,b)=>a.time-b.time);
            container.innerHTML = favorites.map((f,i) => `
                <div class="list-item">
                    <div style="color:#ccc;">${i+1}</div>
                    <img src="${f.img}" class="list-thumb" onclick="showBigImg('${f.img}')" style="cursor:zoom-in">
                    <div class="list-details"><div style="font-size:12px;color:#999;">${f.sku}</div><div style="font-weight:bold;">${f.name}</div></div>
                    <div style="cursor:pointer;padding:10px;" onclick="toggleFav('${f.id}')">ğŸ—‘ï¸</div>
                </div>`).join('');
        }
        function exportToExcel() {
            if (favorites.length === 0) return alert("æ¸…å•ä¸ºç©º");
            const date = new Date();
            const dateStr = `${date.getMonth()+1}æœˆ${date.getDate()}æ—¥`;
            let excelContent = `<html xmlns:x="urn:schemas-microsoft-com:office:excel"><body><table>
                <tr><td colspan="4" style="background:#eee;padding:10px;">å®¢æˆ·ï¼š${userInfo.name}<br>è”ç³»ï¼š${userInfo.contact}<br>æ—¶é—´ï¼š${date.toLocaleString()}</td></tr>
                <tr><th>å›¾ç‰‡</th><th>è´§å·</th><th>å“å</th><th>å¤‡æ³¨</th></tr>`;
            favorites.forEach(f => {
                excelContent += `<tr><td height="100" width="100"><img src="${f.img}" width="80" height="80"></td><td style="mso-number-format:'\@'">${f.sku}</td><td>${f.name}<br>${f.desc}</td><td></td></tr>`;
            });
            excelContent += `</table></body></html>`;
            const link = document.createElement('a');
            link.href = URL.createObjectURL(new Blob([excelContent], { type: 'application/vnd.ms-excel' }));
            link.download = `Leoæ¸…å•_${userInfo.name}_${dateStr}.xls`;
            link.click();
        }

        init();
    </script>
</body>
</html>
