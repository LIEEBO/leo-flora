<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leo Flora Catalog </title>
    <script src="//cdn.jsdelivr.net/npm/leancloud-storage@4.15.0/dist/av-min.js"></script>
    <style>
        :root { --primary-color: #2c3e50; --accent-color: #e74c3c; --bg-color: #f8f9fa; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 0; padding: 0; background-color: var(--bg-color); color: #333; padding-bottom: 100px; }
        
        header { background: white; padding: 15px 30px; box-shadow: 0 2px 15px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        h1 { margin: 0; font-size: 1.2rem; color: var(--primary-color); display: flex; align-items: center; gap: 10px; }
        .header-logo { height: 40px; width: auto; border-radius: 4px; }
        
        .lang-select { padding: 6px 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px; outline: none; background: white; cursor: pointer; }
        .search-box { width: 100%; max-width: 400px; position: relative; }
        .search-input { width: 100%; padding: 10px 15px; border: 1px solid #ddd; border-radius: 20px; font-size: 14px; background: #f0f2f5; outline: none; transition: all 0.2s; box-sizing: border-box; }

        .container { max-width: 1200px; margin: 20px auto; padding: 0 20px; }
        .product-grid { display: grid; gap: 20px; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); }
        .product-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); position: relative; display: flex; flex-direction: column; transition: transform 0.2s; border: 1px solid #f0f0f0; }
        .product-card:hover { transform: translateY(-5px); }
        .product-img { width: 100%; height: 240px; object-fit: cover; background: #eee; cursor: zoom-in; }
        .product-info { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; }
        .product-sku { font-size: 0.75rem; color: #888; margin-bottom: 6px; background: #f0f2f5; display: inline-block; padding: 3px 8px; border-radius: 4px; width: fit-content; font-weight: bold; }
        .product-title { font-size: 1.1rem; font-weight: bold; margin: 0 0 8px 0; }
        .product-details { font-size: 0.8rem; color: #666; display: flex; flex-wrap: wrap; gap: 10px; margin-top: auto; border-top: 1px solid #f9f9f9; padding-top: 10px; }
        
        .fav-btn { position: absolute; top: 10px; right: 10px; width: 40px; height: 40px; border-radius: 50%; background: rgba(255,255,255,0.9); display: flex; align-items: center; justify-content: center; cursor: pointer; border: 1px solid rgba(0,0,0,0.1); font-size: 20px; color: #ccc; transition: all 0.2s; z-index: 10; }
        .fav-btn.active { color: var(--accent-color); transform: scale(1.1); background: white; }
        
        .floating-bar { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--primary-color); color: white; padding: 12px 25px; border-radius: 50px; box-shadow: 0 8px 30px rgba(0,0,0,0.3); cursor: pointer; display: none; align-items: center; gap: 10px; z-index: 200; font-weight: 500; white-space: nowrap; }
        .count-badge { background: var(--accent-color); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; font-weight: bold; }
        
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 300; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
        .modal-content { background: white; width: 90%; max-width: 480px; border-radius: 20px; padding: 30px; box-sizing: border-box; position: relative; max-height: 85vh; overflow-y: auto; }
        
        .login-input { width: 100%; padding: 14px; margin: 8px 0 20px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        .btn-main { background: var(--primary-color); color: white; width: 100%; padding: 15px; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-main:hover { background: #34495e; }

        .contact-link { display: flex; align-items: center; justify-content: center; padding: 14px; border-radius: 12px; text-decoration: none; color: white; font-weight: 600; margin-bottom: 12px; border: none; width: 100%; cursor: pointer; box-sizing: border-box; }
        .btn-wechat { background: #07C160; }
        .btn-whatsapp { background: #25D366; }
        .btn-email { background: #333; }
        .btn-ins { background: linear-gradient(45deg, #f09433, #dc2743, #bc1888); }
        .close-btn { position: absolute; top: 15px; right: 20px; font-size: 28px; cursor: pointer; color: #bbb; }
    </style>
</head>
<body>

    <header>
        <div style="display:flex; justify-content:space-between; width:100%; align-items:center;">
            <h1>
                <img src="https://img.leofaux.com/products/_cgi-bin_mmwebwx-bin_webwxgetmsgimg__%26MsgID%3D7313558579301065918%26skey%3D%40crypt_4155f2e_c7027c9d62208a662c81c64ac7bc9ff6%26mmweb_appid%3Dwx_webfilehelper.jpeg" class="header-logo">
                Leo Flora
            </h1>
            <div style="display:flex; align-items:center; gap: 10px;">
                <select class="lang-select" id="lang-select" onchange="changeLanguage(this.value)">
                    <option value="zh">‰∏≠Êñá</option>
                    <option value="en">English</option>
                    <option value="es">Espa√±ol</option>
                    <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                </select>
            </div>
        </div>
        <div class="search-box">
            <input type="text" id="search-input" class="search-input" placeholder="Search SKU..." oninput="filterProducts()">
        </div>
    </header>

    <div class="modal-overlay" id="login-modal" style="display: flex;">
        <div class="modal-content" style="text-align:center;">
            <h2 data-i18n="welcome_title">Welcome to Leo Flora</h2>
            <p style="color:#666; font-size:14px; margin-bottom:25px;" data-i18n="welcome_desc">Please fill in your info to begin.</p>
            <div style="text-align:left;">
                <label style="font-size:12px; color:#999;" data-i18n="label_name">Name / Company</label>
                <input type="text" id="input-name" class="login-input" placeholder="Your Name">
                <label style="font-size:12px; color:#999;" data-i18n="label_contact">Contact Method</label>
                <input type="text" id="input-contact" class="login-input" placeholder="WhatsApp / WeChat / Email">
            </div>
            <button class="btn-main" onclick="saveUserInfo()" data-i18n="btn_start">Start / ÂºÄÂßãÈÄâÂìÅ</button>
        </div>
    </div>

    <div class="container">
        <div id="loading-tip" style="text-align:center; padding:100px; color:#999;">Loading Exhibit...</div>
        <div id="product-grid" class="product-grid"></div>
    </div>

    <div class="floating-bar" id="floating-bar" onclick="openFavModal()">
        <span data-i18n="view_list">Êü•ÁúãÊàëÁöÑÊÑèÂêëÊ∏ÖÂçï</span>
        <span class="count-badge" id="fav-count">0</span>
    </div>

    <div class="modal-overlay" id="fav-modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeFavModal()">&times;</span>
            <h2 style="margin-top:0; text-align:center;" data-i18n="list_title">ÊÑèÂêëÊ∏ÖÂçïÁ°ÆËÆ§</h2>
            <div id="fav-items-container" style="max-height:400px; overflow-y:auto; margin: 20px 0;"></div>
            <button class="btn-main" style="background:#27ae60;" onclick="exportToExcel()" data-i18n="btn_export">ÂØºÂá∫ Excel Ê∏ÖÂçï</button>
        </div>
    </div>

    <div class="modal-overlay" id="contact-guide-modal" style="display:none;">
        <div class="modal-content" style="text-align:center;">
            <span class="close-btn" onclick="closeContactModal()">&times;</span>
            <div style="font-size: 50px; margin-bottom: 10px;">‚úÖ</div>
            <h2 style="margin-top:0;" data-i18n="export_success">Ê∏ÖÂçïÂØºÂá∫ÊàêÂäüÔºÅ</h2>
            <p style="color:#666; font-size:14px; margin-bottom:25px; line-height: 1.6;">
                <span data-i18n="export_guide">ËØ∑Â∞Ü‰∏ãËΩΩÁöÑÊñá‰ª∂ÂèëÈÄÅËá≥‰∏ãÊñπËÅîÁ≥ªÊñπÂºèÔºö</span><br>
                <span style="font-size:12px; color:#999;" data-i18n="export_note">ÔºàÊàë‰ª¨Â∞ÜÁªôÊÇ®ÂèëÈÄÅÂÆåÊï¥Êä•‰ª∑ÂçïÔºâ</span>
            </p>
            
            <button class="contact-link btn-wechat" onclick="copyText('Leo92-02')">ÂæÆ‰ø° / WeChat: Leo92-02 (ÁÇπÂáªÂ§çÂà∂)</button>
            <a href="https://wa.me/8618657926791" target="_blank" class="contact-link btn-whatsapp">WhatsApp: +86 186 5792 6791</a>
            <a href="mailto:lcf18657926791@gmail.com" class="contact-link btn-email">Email: lcf18657926791@gmail.com</a>
            <a href="https://www.instagram.com/leoflorist" target="_blank" class="contact-link btn-ins">Instagram: @leoflorist</a>
        </div>
    </div>

    <script>
        // LeanCloud ÂØÜÈí•
        const APP_ID = "14iZrTXCibSIZUvrYW1Zx0Nv-MdYXbMMI"; 
        const APP_KEY = "4ClJ1QFB6kPuL8tPCzXe0F1l";
        const SERVER_URL = "https://14izrtxc.api.lncldglobal.com"; 

        const translations = {
            zh: { view_list: "Êü•ÁúãÊàëÁöÑÊÑèÂêëÊ∏ÖÂçï", welcome_title: "Ê¨¢ËøéÂÖâ‰∏¥ Leo Flora", welcome_desc: "ËØ∑Â°´ÂÜôËÅîÁ≥ª‰ø°ÊÅØÂºÄÂßãÈÄâÂìÅ", label_name: "ÊÇ®ÁöÑÁß∞Âëº / ÂÖ¨Âè∏Âêç", label_contact: "ËÅîÁ≥ªÊñπÂºè (ÂæÆ‰ø°/ÈÇÆÁÆ±)", btn_start: "ÂºÄÂßãÈÄâÂìÅ", list_title: "üìã ÊÑèÂêëÊ∏ÖÂçïÁ°ÆËÆ§", btn_export: "üì• ÂØºÂá∫ Excel Ê∏ÖÂçï", export_success: "Ê∏ÖÂçïÂØºÂá∫ÊàêÂäüÔºÅ", export_guide: "ËØ∑Â∞Ü‰∏ãËΩΩÁöÑÊñá‰ª∂ÂèëÈÄÅËá≥‰∏ãÊñπËÅîÁ≥ªÊñπÂºèÔºö", export_note: "ÔºàÊàë‰ª¨Â∞ÜÁªôÊÇ®ÂèëÈÄÅÂÆåÊï¥Êä•‰ª∑ÂçïÔºâ" },
            en: { view_list: "View My Wishlist", welcome_title: "Welcome to Leo Flora", welcome_desc: "Please fill in your info to begin.", label_name: "Name / Company", label_contact: "Contact (WhatsApp/Email)", btn_start: "Start Selection", list_title: "üìã Wishlist Confirmation", btn_export: "üì• Export to Excel", export_success: "Wishlist Exported!", export_guide: "Please send the file via:", export_note: "(We will send you a complete quotation)" },
            es: { view_list: "Ver Mi Lista", welcome_title: "Bienvenido a Leo Flora", welcome_desc: "Por favor complete su informaci√≥n.", label_name: "Nombre / Empresa", label_contact: "Contacto (WhatsApp/Email)", btn_start: "Comenzar", list_title: "üìã Confirmar Lista", btn_export: "üì• Exportar Excel", export_success: "¬°Exportado con √©xito!", export_guide: "Env√≠enos el archivo por:", export_note: "(Le enviaremos una cotizaci√≥n completa)" },
            ar: { view_list: "ÿπÿ±ÿ∂ ŸÇÿßÿ¶ŸÖÿ™Ÿä", welcome_title: "ŸÖÿ±ÿ≠ÿ®ÿß ÿ®ŸÉŸÖ ŸÅŸä Leo Flora", welcome_desc: "Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ŸÖÿπŸÑŸàŸÖÿßÿ™ŸÉ ŸÑŸÑÿ®ÿØÿ°.", label_name: "ÿßŸÑÿßÿ≥ŸÖ / ÿßŸÑÿ¥ÿ±ŸÉÿ©", label_contact: "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ", btn_start: "ÿßÿ®ÿØÿ£", list_title: "üìã ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©", btn_export: "üì• ÿ™ÿµÿØŸäÿ± Excel", export_success: "ÿ™ŸÖ ÿßŸÑÿ™ÿµÿØŸäÿ± ÿ®ŸÜÿ¨ÿßÿ≠!", export_guide: "Ÿäÿ±ÿ¨Ÿâ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑŸÖŸÑŸÅ ÿπÿ®ÿ±:", export_note: "(ÿ≥ŸàŸÅ ŸÜÿ±ÿ≥ŸÑ ŸÑŸÉ ÿπÿ±ÿ∂ ÿ≥ÿπÿ± ŸÉÿßŸÖŸÑ)" }
        };

        let currentLang = 'zh';
        let products = [];
        let favorites = [];
        let userInfo = { name: "", contact: "" };

        function init() {
            AV.init({ appId: APP_ID, appKey: APP_KEY, serverURLs: SERVER_URL });
            const savedUser = localStorage.getItem('leo_user_lc');
            if (savedUser) { 
                userInfo = JSON.parse(savedUser); 
                document.getElementById('login-modal').style.display = 'none';
            }
            fetchData();
        }

        function fetchData() {
            const query = new AV.Query('Product');
            query.limit(1000);
            query.find().then(res => {
                products = res.map(p => ({
                    id: p.id,
                    sku: p.get('sku'),
                    img: p.get('img'),
                    name_zh: p.get('name_zh') || p.get('name'),
                    name_en: p.get('name_en'),
                    name_es: p.get('name_es'),
                    name_ar: p.get('name_ar'),
                    size: p.get('desc')
                }));
                document.getElementById('loading-tip').style.display = 'none';
                renderProducts(products);
            });
        }

        function renderProducts(list) {
    const grid = document.getElementById('product-grid');
    grid.innerHTML = list.map(p => {
        const isFav = favorites.find(f => f.id === p.id);
        const displayName = p['name_' + currentLang] || p.name_en || p.name_zh || p.name_es || p.name_ar || 'Flower Item';
        
        return `
        <div class="product-card">
            <img src="${p.img}" class="product-img" loading="lazy" onclick="toggleFav('${p.id}')">
            <button class="fav-btn ${isFav ? 'active' : ''}" onclick="toggleFav('${p.id}')">${isFav ? '‚ù§Ô∏è' : '‚ûï'}</button>
            <div class="product-info">
                <span class="product-sku">ITEM NO: ${p.sku}</span>
                <div class="product-title">${displayName}</div>
                <div class="product-details">
                    <span>Size: ${p.size || '-'}</span>
                </div>
            </div>
        </div>`;
    }).join('');
}

        function saveUserInfo() {
            const name = document.getElementById('input-name').value.trim();
            const contact = document.getElementById('input-contact').value.trim();
            if(!name || !contact) return alert("Please fill in your name and contact info.");
            userInfo = { name, contact };
            localStorage.setItem('leo_user_lc', JSON.stringify(userInfo));
            document.getElementById('login-modal').style.display = 'none';
        }

        function toggleFav(id) {
            const p = products.find(x => x.id === id);
            const idx = favorites.findIndex(f => f.id === id);
            if (idx === -1) favorites.push(p); else favorites.splice(idx, 1);
            updateBadge();
            renderProducts(products);
        }

        function updateBadge() {
            const bar = document.getElementById('floating-bar');
            document.getElementById('fav-count').innerText = favorites.length;
            bar.style.display = favorites.length > 0 ? 'flex' : 'none';
        }

        function changeLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) el.innerText = t[key];
            });
            renderProducts(products);
        }

        function exportToExcel() {
            if (favorites.length === 0) return;
            const dateStr = new Date().toLocaleDateString();
            let excelContent = `<html><head><meta charset="UTF-8"></head><body>
                <table border="1">
                    <tr style="background:#f0f0f0;"><td colspan="6"><b>Client: ${userInfo.name} | Contact: ${userInfo.contact} | Date: ${dateStr}</b></td></tr>
                    <tr style="background:#2c3e50; color:white;">
                        <th>Image</th><th>SKU</th><th>Name</th><th>Size</th><th>Qty/CTN</th><th>CBM</th>
                    </tr>`;
            favorites.forEach(f => {
                excelContent += `<tr>
                    <td height="60"><img src="${f.img}" width="50"></td>
                    <td>${f.sku}</td>
                    <td>${f.name_zh}</td>
                    <td>${f.name_en}</td>
                    <td>${f.name_es}</td>
                    <td>${f.name_ar}</td>
                    <td>${f.size || ''}</td>
                </tr>`;
            });
            excelContent += `</table></body></html>`;
            const link = document.createElement('a');
            link.href = URL.createObjectURL(new Blob([excelContent], { type: 'application/vnd.ms-excel' }));
            link.download = `LeoFlora_Wishlist_${userInfo.name}.xls`;
            link.click();

            closeFavModal();
            setTimeout(() => { document.getElementById('contact-guide-modal').style.display = 'flex'; }, 500);
        }

        function openFavModal() {
            const container = document.getElementById('fav-items-container');
            container.innerHTML = favorites.map(f => `
                <div style="display:flex; align-items:center; gap:12px; border-bottom:1px solid #eee; padding:10px 0;">
                    <img src="${f.img}" style="width:50px; height:50px; object-fit:cover; border-radius:4px;">
                    <div style="flex:1;">
                        <div style="font-size:12px; font-weight:bold; color:#2c3e50;">${f.sku}</div>
                        <div style="font-size:11px; color:#666;">${f.name_zh}</div>
                    </div>
                    <span onclick="toggleFav('${f.id}'); openFavModal();" style="cursor:pointer; color:#ccc;">‚úï</span>
                </div>
            `).join('') || '<p style="text-align:center; color:#ccc;">Empty list</p>';
            document.getElementById('fav-modal').style.display = 'flex';
        }

        function closeFavModal() { document.getElementById('fav-modal').style.display = 'none'; }
        function closeContactModal() { document.getElementById('contact-guide-modal').style.display = 'none'; }
        function copyText(t) { navigator.clipboard.writeText(t).then(() => alert("Copied: " + t)); }

        function filterProducts() {
            const key = document.getElementById('search-input').value.toLowerCase().trim();
            const filtered = products.filter(p => p.sku.toLowerCase().includes(key) || p.name_zh.toLowerCase().includes(key));
            renderProducts(filtered);
        }

        init();
    </script>
</body>
</html>
