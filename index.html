<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leo Flora Catalog</title>
    <script src="//cdn.jsdelivr.net/npm/leancloud-storage@4.15.0/dist/av-min.js"></script>
    <style>
        :root { --primary-color: #2c3e50; --accent-color: #e74c3c; --bg-color: #f8f9fa; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 0; padding: 0; background-color: var(--bg-color); color: #333; padding-bottom: 100px; }
        
        header { background: white; padding: 15px 30px; box-shadow: 0 2px 15px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        h1 { margin: 0; font-size: 1.2rem; color: var(--primary-color); display: flex; align-items: center; gap: 10px; }
        .logo-icon { font-size: 1.5rem; }
        
        /* æ–°å¢ï¼šLogo å›¾ç‰‡æ ·å¼ */
        .header-logo { height: 40px; width: auto; border-radius: 4px; }
        
        .lang-select { padding: 6px 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px; outline: none; background: white; cursor: pointer; }
        
        .search-box { width: 100%; max-width: 400px; position: relative; }
        .search-input { width: 100%; padding: 10px 15px; border: 1px solid #ddd; border-radius: 20px; font-size: 14px; background: #f0f2f5; outline: none; transition: all 0.2s; box-sizing: border-box; }
        .search-input:focus { background: white; border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(44, 62, 80, 0.1); }

        .container { max-width: 1200px; margin: 20px auto; padding: 0 20px; }
        .product-grid { display: grid; gap: 20px; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); }
        .product-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); position: relative; display: flex; flex-direction: column; transition: transform 0.2s; }
        .product-card:hover { transform: translateY(-5px); }
        .product-img { width: 100%; height: 240px; object-fit: cover; background: #eee; cursor: zoom-in; }
        .product-info { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; }
        .product-sku { font-size: 0.75rem; color: #888; margin-bottom: 6px; background: #f0f2f5; display: inline-block; padding: 3px 8px; border-radius: 4px; width: fit-content; }
        .product-title { font-size: 1.1rem; font-weight: bold; margin: 0 0 8px 0; }
        .product-desc { font-size: 0.85rem; color: #666; margin: 0; }
        
        .fav-btn { position: absolute; top: 10px; right: 10px; width: 40px; height: 40px; border-radius: 50%; background: rgba(255,255,255,0.9); display: flex; align-items: center; justify-content: center; cursor: pointer; border: 1px solid rgba(0,0,0,0.1); font-size: 20px; color: #ccc; transition: all 0.2s; }
        html[dir="rtl"] .fav-btn { right: auto; left: 10px; }
        .fav-btn.active { background: white; color: var(--accent-color); transform: scale(1.1); }
        
        .floating-bar { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--primary-color); color: white; padding: 12px 25px; border-radius: 50px; box-shadow: 0 8px 30px rgba(0,0,0,0.3); cursor: pointer; display: flex; align-items: center; gap: 10px; z-index: 200; font-weight: 500; white-space: nowrap; }
        .count-badge { background: var(--accent-color); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; font-weight: bold; }
        
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 300; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
        .modal-content { background: white; width: 90%; max-width: 500px; border-radius: 16px; padding: 30px; box-sizing: border-box; position: relative; }
        
        #img-viewer { z-index: 999; background: rgba(0,0,0,0.9); cursor: zoom-out; }
        #big-img { max-width: 95%; max-height: 95vh; object-fit: contain; border-radius: 4px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }

        .login-input { width: 100%; padding: 14px; margin: 8px 0 20px 0; border: 2px solid #eee; border-radius: 8px; box-sizing: border-box; }
        .login-btn, .export-btn { background: var(--primary-color); color: white; width: 100%; padding: 14px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; }
        .export-btn { background: #27ae60; margin-top: 20px; }
        .list-item { padding: 15px 0; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 15px; }
        .list-thumb { width: 60px; height: 60px; object-fit: cover; border-radius: 6px; }
        .list-details { flex-grow: 1; }
        .close-btn { position: absolute; top: 15px; right: 20px; font-size: 28px; cursor: pointer; color: #bbb; }
        html[dir="rtl"] .close-btn { right: auto; left: 20px; }

        /* æ–°å¢ï¼šè”ç³»æ–¹å¼æŒ‰é’®æ ·å¼ */
        ./* æ–°å¢ï¼šè”ç³»æ–¹å¼æŒ‰é’®æ ·å¼ */
.contact-link { 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    padding: 14px; 
    border-radius: 12px; 
    text-decoration: none; 
    color: white; 
    font-weight: 600; 
    margin-bottom: 12px; 
    border: none; 
    width: 100%; 
    cursor: pointer;
    box-sizing: border-box; /* æ·»åŠ è¿™ä¸€è¡Œï¼Œç¡®ä¿å®½åº¦åŒ…å«å†…è¾¹è·ï¼Œä½¿æ‰€æœ‰é•¿æ¡å¯¹é½ */
}
        .btn-wechat { background: #07C160; }
        .btn-whatsapp { background: #25D366; }
        .btn-email { background: #333; }
        .btn-ins { background: linear-gradient(45deg, #f09433, #dc2743, #bc1888); }

        .loading { text-align: center; padding: 50px; color: #999; }
        
        @media (max-width: 768px) {
            header { flex-direction: column; align-items: stretch; gap: 15px; }
            .header-controls { justify-content: space-between; }
            .search-box { max-width: 100%; }
            .product-grid { grid-template-columns: 1fr; gap: 15px; }
            .product-card { flex-direction: row; align-items: stretch; height: auto; }
            .product-img { width: 120px; height: auto; min-height: 120px; }
            .fav-btn { top: 50%; right: 15px; transform: translateY(-50%); background: #f8f9fa; border: 1px solid #eee; }
            html[dir="rtl"] .fav-btn { right: auto; left: 15px; }
        }
    </style>
</head>
<body>

    <header>
        <div style="display:flex; justify-content:space-between; width:100%; align-items:center;" class="header-controls">
            <h1>
                <img src="https://img.leofaux.com/products/leofaux-logo.png" class="header-logo">
                Leo Flora
            </h1>
            <div style="display:flex; align-items:center; gap: 10px;">
                <select class="lang-select" id="lang-select" onchange="changeLanguage(this.value)">
                    <option value="zh">ä¸­æ–‡</option>
                    <option value="en">English</option>
                    <option value="es">EspaÃ±ol</option>
                    <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                </select>
                <span id="header-user-name" style="font-size:0.9rem;color:#666; display:none;"></span>
                <div id="btn-edit-info" style="font-size:12px;color:#999;cursor:pointer;border:1px solid #eee;padding:4px 8px;border-radius:4px;" onclick="showLoginModal()">
                    <span data-i18n="edit_info">ä¿®æ”¹</span>
                </div>
            </div>
        </div>
        <div class="search-box">
            <input type="text" id="search-input" class="search-input" placeholder="Search..." oninput="filterProducts()">
        </div>
    </header>

    <div class="container">
        <div id="loading-tip" class="loading">Loading data...</div>
        <div id="no-result-tip" class="loading" style="display:none;" data-i18n="no_result">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„äº§å“</div>
        <div id="product-grid" class="product-grid"></div>
    </div>

    <div class="floating-bar" onclick="openFavModal()">
        <span data-i18n="view_list">æŸ¥çœ‹æˆ‘çš„æ„å‘æ¸…å•</span>
        <span class="count-badge" id="fav-count">0</span>
    </div>

    <div class="modal-overlay" id="img-viewer" onclick="closeBigImg()">
        <img id="big-img" src="" alt="å¤§å›¾">
    </div>

    <div class="modal-overlay" id="login-modal" style="display:flex;">
        <div class="modal-content" style="text-align:center;">
            <h2 style="margin-top:0;" data-i18n="welcome_title">Welcome to Leo Flora</h2>
            <p style="color:#666; font-size:14px; margin-bottom:25px;" data-i18n="welcome_desc">Please fill in your info to begin.</p>
            <input type="text" id="input-name" class="login-input" placeholder="Name / Company">
            <input type="text" id="input-contact" class="login-input" placeholder="Contact (WeChat/Email)">
            <button class="login-btn" onclick="saveUserInfo()" data-i18n="btn_start">Start</button>
        </div>
    </div>

    <div class="modal-overlay" id="fav-modal">
        <div class="modal-content" style="max-height:85vh; display:flex; flex-direction:column;">
            <span class="close-btn" onclick="closeFavModal()">&times;</span>
            <h2 style="margin-top:0;" data-i18n="list_title">æ„å‘æ¸…å•ç¡®è®¤</h2>
            <div id="fav-items-container" style="flex-grow:1; overflow-y:auto;"></div>
            <button class="export-btn" onclick="exportToExcel()">
                <span data-i18n="btn_export">å¯¼å‡º Excel æ¸…å•</span>
            </button>
        </div>
    </div>

    <div class="modal-overlay" id="contact-guide-modal">
        <div class="modal-content" style="text-align:center;">
            <span class="close-btn" onclick="closeContactModal()">&times;</span>
            <div style="font-size: 50px; margin-bottom: 10px;">âœ…</div>
            <h2 style="margin-top:0;">æ¸…å•å¯¼å‡ºæˆåŠŸï¼</h2>
            <p style="color:#666; font-size:14px; margin-bottom:25px;">
    è¯·å°†ä¸‹è½½çš„æ–‡ä»¶å‘é€è‡³ä¸‹æ–¹è”ç³»æ–¹å¼ï¼š<br>
    <span style="font-size:12px; color:#999;">ï¼ˆæˆ‘ä»¬å°†ç»™æ‚¨å‘é€å®Œæ•´æŠ¥ä»·å•ï¼‰</span>
</p>
            
            <button class="contact-link btn-wechat" onclick="copyText('Leo92-02')">å¾®ä¿¡ / WeChat: Leo92-02 (ç‚¹å‡»å¤åˆ¶)</button>
            <a href="https://wa.me/8618657926791" target="_blank" class="contact-link btn-whatsapp">WhatsApp: +86 186 5792 6791</a>
            <a href="mailto:lcf18657926791@gmail.com" class="contact-link btn-email">Email: lcf18657926791@gmail.com</a>
            <a href="https://www.instagram.com/leoflorist" target="_blank" class="contact-link btn-ins">Instagram: @leoflorist</a>
            
            <button class="login-btn" style="margin-top:20px; background:#eee; color:#333;" onclick="closeContactModal()">å®Œæˆ</button>
        </div>
    </div>

    <script>
        // ==========================================
        // ğŸ‘‡ğŸ‘‡ğŸ‘‡ è¿™é‡Œçš„å¯†é’¥è¯·åŠ¡å¿…å¡«å…¥ ğŸ‘‡ğŸ‘‡ğŸ‘‡
        const APP_ID = "14iZrTXCibSIZUvrYW1Zx0Nv-MdYXbMMI"; 
        const APP_KEY = "4ClJ1QFB6kPuL8tPCzXe0F1l";
        const SERVER_URL = "https://14izrtxc.api.lncldglobal.com"; 
        // ==========================================

        const translations = {
            zh: { edit_info: "ä¿®æ”¹ä¿¡æ¯", search_placeholder: "ğŸ” æœç´¢è´§å· / å“å...", no_result: "æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„äº§å“", view_list: "æŸ¥çœ‹æˆ‘çš„æ„å‘æ¸…å•", welcome_title: "æ¬¢è¿å…‰ä¸´ Leo Flora", welcome_desc: "è¯·å¡«å†™è”ç³»ä¿¡æ¯å¼€å§‹é€‰å“", placeholder_name: "æ‚¨çš„ç§°å‘¼ / å…¬å¸å", placeholder_contact: "è”ç³»æ–¹å¼ (å¾®ä¿¡/é‚®ç®±)", btn_start: "å¼€å§‹é€‰å“", list_title: "ğŸ“‹ æ„å‘æ¸…å•ç¡®è®¤", list_empty: "æ¸…å•ä¸ºç©º", btn_export: "ğŸ“¥ å¯¼å‡º Excel æ¸…å•", sku_prefix: "è´§å·: ", excel_client: "å®¢æˆ·", excel_contact: "è”ç³»", excel_date: "æ—¶é—´", excel_img: "å›¾ç‰‡", excel_sku: "è´§å·", excel_name: "å“å", excel_note: "å¤‡æ³¨" },
            en: { edit_info: "Edit Info", search_placeholder: "ğŸ” Search SKU / Name...", no_result: "No products found", view_list: "View My List", welcome_title: "Welcome to Leo Flora", welcome_desc: "Please fill in your info to begin.", placeholder_name: "Your Name / Company", placeholder_contact: "Contact (WhatsApp/Email)", btn_start: "Start Selection", list_title: "ğŸ“‹ Wishlist Confirmation", list_empty: "Your list is empty", btn_export: "ğŸ“¥ Export to Excel", sku_prefix: "SKU: ", excel_client: "Client", excel_contact: "Contact", excel_date: "Date", excel_img: "IMAGE", excel_sku: "SKU", excel_name: "NAME", excel_note: "NOTE" },
            es: { edit_info: "Editar Info", search_placeholder: "ğŸ” Buscar SKU / Nombre...", no_result: "No se encontraron productos", view_list: "Ver Mi Lista", welcome_title: "Bienvenido a Leo Flora", welcome_desc: "Por favor complete su informaciÃ³n.", placeholder_name: "Su Nombre / Empresa", placeholder_contact: "Contacto (WhatsApp/Email)", btn_start: "Comenzar", list_title: "ğŸ“‹ Confirmar Lista", list_empty: "La lista estÃ¡ vacÃ­a", btn_export: "ğŸ“¥ Exportar a Excel", sku_prefix: "REF: ", excel_client: "Cliente", excel_contact: "Contacto", excel_date: "Fecha", excel_img: "IMAGEN", excel_sku: "SKU", excel_name: "NOMBRE", excel_note: "NOTA" },
            ar: { edit_info: "ØªØ¹Ø¯ÙŠÙ„", search_placeholder: "ğŸ” Ø¨Ø­Ø« Ø¹Ù† SKU / Ø§Ù„Ø§Ø³Ù…...", no_result: "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù†ØªØ¬Ø§Øª", view_list: "Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…ØªÙŠ", welcome_title: "Ù…Ø±Ø­Ø¨Ø§ Ø¨ÙƒÙ… ÙÙŠ Leo Flora", welcome_desc: "ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ù„Ù„Ø¨Ø¯Ø¡.", placeholder_name: "Ø§Ù„Ø§Ø³Ù… / Ø§Ù„Ø´Ø±ÙƒØ©", placeholder_contact: "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„", btn_start: "Ø§Ø¨Ø¯Ø£", list_title: "ğŸ“‹ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©", list_empty: "Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø±ØºØ©", btn_export: "ğŸ“¥ ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel", sku_prefix: "Ø±Ù…Ø²: ", excel_client: "Ø§Ù„Ø¹Ù…ÙŠÙ„", excel_contact: "Ø§ØªØµØ§Ù„", excel_date: "Ø§Ù„ØªØ§Ø±ÙŠØ®", excel_img: "ØµÙˆØ±Ø©", excel_sku: "Ø±Ù…Ø² Ø§Ù„Ù…Ù†ØªØ¬", excel_name: "Ø§Ù„Ø§Ø³Ù…", excel_note: "Ù…Ù„Ø§Ø­Ø¸Ø©" }
        };

        let currentLang = 'zh';
        let products = [];
        let favorites = [];
        let userInfo = { name: "", contact: "" };

        function init() {
            if (APP_ID.includes("è¯·åœ¨è¿™é‡Œ")) {
                document.getElementById('loading-tip').innerText = "âš ï¸ è¯·å¡«å†™ App ID å’Œ Key (Please set App ID)";
                return;
            }
            AV.init({ appId: APP_ID, appKey: APP_KEY, serverURLs: SERVER_URL });

            try {
                const savedFavs = localStorage.getItem('leo_favs_lc');
                if (savedFavs) favorites = JSON.parse(savedFavs);
                const savedUser = localStorage.getItem('leo_user_lc');
                if (savedUser) userInfo = JSON.parse(savedUser);
                const savedLang = localStorage.getItem('leo_lang');
                if (savedLang && translations[savedLang]) {
                    currentLang = savedLang;
                    document.getElementById('lang-select').value = currentLang;
                }
            } catch (e) {}

            applyLanguage(currentLang);
            checkLogin();
            updateBadge();

            const query = new AV.Query('Product');
            query.limit(1000); 
            query.find().then((results) => {
                products = results.map(item => ({
                    id: item.id,
                    sku: item.get('sku') || "",
                    img: item.get('img') || "",
                    name_zh: item.get('name_zh') || item.get('name') || "", 
                    name_en: item.get('name_en') || "",
                    name_es: item.get('name_es') || "",
                    name_ar: item.get('name_ar') || "",
                    desc: item.get('desc') || ""
                }));
                document.getElementById('loading-tip').style.display = 'none';
                renderProducts(products);
            }, (error) => {
                document.getElementById('loading-tip').innerText = "Error: " + error.message;
            });
        }

        function changeLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('leo_lang', lang);
            applyLanguage(lang);
            const keyword = document.getElementById('search-input').value.toLowerCase().trim();
            if (keyword) filterProducts(); else renderProducts(products);
            if(document.getElementById('fav-modal').style.display === 'flex') renderFavList();
        }

        function applyLanguage(lang) {
            const t = translations[lang];
            if (lang === 'ar') document.documentElement.setAttribute('dir', 'rtl');
            else document.documentElement.setAttribute('dir', 'ltr');
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) el.innerText = t[key];
            });
            document.getElementById('search-input').placeholder = t.search_placeholder;
            document.getElementById('input-name').placeholder = t.placeholder_name;
            document.getElementById('input-contact').placeholder = t.placeholder_contact;
        }

        function getDisplayName(p) {
            if (currentLang === 'en' && p.name_en) return p.name_en;
            if (currentLang === 'es' && p.name_es) return p.name_es;
            if (currentLang === 'ar' && p.name_ar) return p.name_ar;
            return p.name_zh || p.name_en; 
        }

        function renderProducts(list) {
            const container = document.getElementById('product-grid');
            const noResultTip = document.getElementById('no-result-tip');
            const t = translations[currentLang];
            
            if (list.length === 0 && products.length > 0) {
                container.style.display = 'none';
                noResultTip.style.display = 'block';
                return;
            } else {
                container.style.display = 'grid';
                noResultTip.style.display = 'none';
            }

            container.innerHTML = list.map(p => {
                const isFav = favorites.find(f => f.id === p.id);
                const displayName = getDisplayName(p);
                
                return `
                <div class="product-card">
                    <img src="${p.img}" class="product-img" loading="lazy" onclick="showBigImg('${p.img}')">
                    <button class="fav-btn ${isFav ? 'active' : ''}" onclick="toggleFav('${p.id}')">
                        ${isFav ? 'â¤ï¸' : 'â•'}
                    </button>
                    <div class="product-info">
                        <span class="product-sku">${t.sku_prefix}${p.sku}</span>
                        <div class="product-title">${displayName}</div>
                        <div class="product-desc">${p.desc}</div>
                    </div>
                </div>`;
            }).join('');
        }

        function filterProducts() {
            const keyword = document.getElementById('search-input').value.toLowerCase().trim();
            if (!keyword) { renderProducts(products); return; }
            const filtered = products.filter(p => 
                p.sku.toLowerCase().includes(keyword) || 
                p.name_zh.toLowerCase().includes(keyword) ||
                p.name_en.toLowerCase().includes(keyword) ||
                p.name_es.toLowerCase().includes(keyword) ||
                p.name_ar.toLowerCase().includes(keyword)
            );
            renderProducts(filtered);
        }

        function showBigImg(url) {
            document.getElementById('big-img').src = url;
            document.getElementById('img-viewer').style.display = 'flex';
        }
        function closeBigImg() { document.getElementById('img-viewer').style.display = 'none'; }

        function toggleFav(id) {
            const product = products.find(p => p.id === id);
            const index = favorites.findIndex(f => f.id === id);
            if (index === -1) { favorites.push({ ...product, time: Date.now() }); } 
            else { favorites.splice(index, 1); }
            try { localStorage.setItem('leo_favs_lc', JSON.stringify(favorites)); } catch (e) {}
            
            const keyword = document.getElementById('search-input').value.toLowerCase().trim();
            if (keyword) filterProducts(); else renderProducts(products);
            
            updateBadge();
            if(document.getElementById('fav-modal').style.display === 'flex') renderFavList();
        }

        function updateBadge() { document.getElementById('fav-count').innerText = favorites.length; }
        
        function checkLogin() {
            if (userInfo.name) {
                document.getElementById('login-modal').style.display = 'none';
                document.getElementById('header-user-name').style.display = 'inline';
                document.getElementById('header-user-name').innerText = userInfo.name;
            } else { 
                document.getElementById('login-modal').style.display = 'flex'; 
                document.getElementById('header-user-name').style.display = 'none';
            }
        }
        function showLoginModal() { document.getElementById('login-modal').style.display = 'flex'; }
        
        function saveUserInfo() {
            userInfo.name = document.getElementById('input-name').value.trim();
            userInfo.contact = document.getElementById('input-contact').value.trim();
            if(!userInfo.name) return alert("Please fill in info");
            try { localStorage.setItem('leo_user_lc', JSON.stringify(userInfo)); } catch(e) {}
            checkLogin();
        }
        
        function openFavModal() { renderFavList(); document.getElementById('fav-modal').style.display = 'flex'; }
        function closeFavModal() { document.getElementById('fav-modal').style.display = 'none'; }
        
        function renderFavList() {
            const container = document.getElementById('fav-items-container');
            const t = translations[currentLang];
            
            if (favorites.length === 0) { container.innerHTML = `<div style="text-align:center;color:#ccc;margin-top:50px;">${t.list_empty}</div>`; return; }
            favorites.sort((a,b)=>a.time-b.time);
            
            container.innerHTML = favorites.map((f,i) => {
                const displayName = getDisplayName(f);
                return `
                <div class="list-item">
                    <div style="color:#ccc;">${i+1}</div>
                    <img src="${f.img}" class="list-thumb" onclick="showBigImg('${f.img}')" style="cursor:zoom-in">
                    <div class="list-details"><div style="font-size:12px;color:#999;">${f.sku}</div><div style="font-weight:bold;">${displayName}</div></div>
                    <div style="cursor:pointer;padding:10px;" onclick="toggleFav('${f.id}')">ğŸ—‘ï¸</div>
                </div>`;
            }).join('');
        }

        // æ–°å¢ï¼šå…³é—­è”ç³»æ–¹å¼å¼¹çª—çš„å°å‡½æ•°
        function closeContactModal() { document.getElementById('contact-guide-modal').style.display = 'none'; }

        // æ–°å¢ï¼šç‚¹å‡»å¤åˆ¶å¾®ä¿¡å·çš„å°å‡½æ•°
        function copyText(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert("å¾®ä¿¡å·å·²å¤åˆ¶: " + text + "\nè¯·æ‰“å¼€å¾®ä¿¡æ·»åŠ å¥½å‹ã€‚");
            });
        }

        function exportToExcel() {
            const t = translations[currentLang];
            if (favorites.length === 0) return alert(t.list_empty);
            
            const date = new Date();
            const dateStr = date.toLocaleDateString();
            
            let excelContent = `
            <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">
            <head>
                <meta http-equiv="content-type" content="application/vnd.ms-excel; charset=UTF-8">
                <style>
                    table { border-collapse: collapse; width: 100%; }
                    td, th { border: 1px solid #999; text-align: center; vertical-align: middle; padding: 5px; }
                    .sku-cell { mso-number-format:'\@'; }
                </style>
            </head>
            <body>
            <table dir="${currentLang === 'ar' ? 'rtl' : 'ltr'}">
                <tr><td colspan="4" style="background:#f0f0f0; padding:10px; font-weight:bold;">
                    LEO FLORA - ${t.list_title}<br>
                    ${t.excel_client}: ${userInfo.name} | ${t.excel_contact}: ${userInfo.contact} | ${t.excel_date}: ${dateStr}
                </td></tr>
                <tr style="background:#2c3e50; color:white;">
                    <th>${t.excel_img}</th>
                    <th>${t.excel_sku}</th>
                    <th>${t.excel_name}</th>
                    <th>${t.excel_note}</th>
                </tr>`;
            
            favorites.forEach(f => {
                const displayName = getDisplayName(f);
                excelContent += `
                <tr>
                    <td height="100" width="100"><img src="${f.img}" width="80" height="80"></td>
                    <td class="sku-cell">${f.sku}</td>
                    <td>${displayName}<br><span style="color:#666;">${f.desc}</span></td>
                    <td></td>
                </tr>`;
            });
            excelContent += `</table></body></html>`;
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(new Blob([excelContent], { type: 'application/vnd.ms-excel' }));
            link.download = `LeoFlora_${userInfo.name}_${dateStr}.xls`;
            link.click();

            // --- å…³é”®ä¿®æ”¹ï¼šå¯¼å‡ºåå…³é—­æ¸…å•å¼¹çª—ï¼Œå¹¶æ˜¾ç¤ºè”ç³»å¼¹çª— ---
            closeFavModal();
            setTimeout(() => {
                document.getElementById('contact-guide-modal').style.display = 'flex';
            }, 500);
        }

        init();
    </script>
</body>
</html>
